# Electro - Учёт электроэнергии

Веб-приложение для ежедневного учёта показаний двухзонного электросчётчика с расчётом потребления и стоимости.

**Демо:** https://sowenka.github.io/electro/

## Возможности

- Ввод ежедневных показаний с мгновенным расчётом расхода и стоимости
- Двухзонный тариф: T1 (день) и T2 (ночь)
- Дашборд с KPI-карточками и графиками
- Аналитика по дням, неделям, месяцам, годам и произвольному периоду
- Таблица истории с фильтрацией и удалением
- Экспорт и импорт данных в JSON
- Тёмная и светлая тема
- Адаптивный дизайн (десктоп и мобильные устройства)
- Данные хранятся локально в браузере (localStorage)

---

## Руководство пользователя

### 1. Первый запуск

При первом открытии приложения вы увидите пустой дашборд с предложением добавить первое показание. Данные хранятся в localStorage вашего браузера — они не отправляются на сервер и доступны только вам.

**Важно:** если вы очистите данные браузера или используете режим инкогнито, данные будут потеряны. Рекомендуется периодически делать экспорт (см. раздел "Настройки").

### 2. Ввод показаний

Перейдите на страницу **"Показания"** через боковое меню (на десктопе) или нижнюю навигацию (на телефоне).

**Как вносить показания:**

1. **Дата** — по умолчанию стоит сегодняшняя дата. Можно выбрать другую, если записываете задним числом.

2. **T1 (день)** — введите текущее показание дневного счётчика. Под полем ввода отображается предыдущее показание для справки. Placeholder подсказывает минимально допустимое значение.

3. **T2 (ночь)** — аналогично введите показание ночного счётчика.

4. **Мгновенный расчёт** — как только вы начинаете вводить числа, под каждым полем появляется расчёт:
   - Расход в кВт·ч (разница с предыдущим показанием)
   - Стоимость в рублях (расход × тариф)
   - Внизу — общая карточка "Итого за день"

5. Нажмите **"Сохранить показание"**.

**Правила валидации:**
- Показания не могут быть меньше предыдущих (счётчик не идёт назад)
- Нельзя добавить два показания на одну дату
- Оба поля (T1 и T2) обязательны

**Первое показание** — это базовая точка отсчёта. Расход будет рассчитан только начиная со второго показания.

### 3. Дашборд

Главная страница приложения. Показывает общую картину потребления:

**KPI-карточки (верхняя строка):**
- **Сегодня** — расход и стоимость за текущий день
- **За месяц** — суммарный расход за текущий месяц и количество дней с данными
- **T1 (день)** — расход дневного тарифа за месяц и его стоимость
- **T2 (ночь)** — расход ночного тарифа за месяц и его стоимость

**Карточка "Стоимость за месяц":**
- Крупная цифра общей стоимости
- Разбивка по T1 и T2

**Графики:**
- **"Потребление за 30 дней"** — столбчатая диаграмма, жёлтые столбики = T1 (день), синие = T2 (ночь). Наведите на столбик для подробностей.
- **"День / Ночь"** — круговая диаграмма соотношения дневного и ночного потребления за текущий месяц (в процентах).
- **"Стоимость по дням"** — линейный график стоимости. Наведите на точку для детализации по T1/T2.

**Таблица "Последние записи":**
- 5 последних записей с расходом и стоимостью
- Ссылка "Все записи" ведёт на страницу истории

### 4. История

Полная таблица всех показаний, отсортированная от новых к старым.

**Возможности:**

- **Фильтр по месяцу** — выпадающий список "Все месяцы" вверху страницы. Выберите конкретный месяц, чтобы видеть только его записи.

- **Сводка** — панель с итогами по выбранному фильтру:
  - Количество записей
  - Суммарный расход T1 и T2
  - Стоимость T1
  - Общая стоимость

- **Столбцы таблицы:**
  - Дата
  - T1 (показание счётчика)
  - T2 (показание счётчика)
  - T1 кВт (расход за день) — видно на средних и больших экранах
  - T2 кВт (расход за день) — видно на средних и больших экранах
  - T1 руб. — видно на больших экранах
  - T2 руб. — видно на больших экранах
  - Итого (общая стоимость за день)

- **Удаление** — наведите на строку, справа появится иконка корзины. При удалении записи все последующие показания будут автоматически пересчитаны.

- **Экспорт** — кнопка "Экспорт" в правом верхнем углу сохраняет все данные в JSON-файл.

### 5. Аналитика

Расширенный анализ потребления за любой период.

**Выбор периода (кнопки вверху):**
- **По дням** — каждый день отдельной точкой
- **По неделям** — данные сгруппированы по неделям
- **По месяцам** — данные сгруппированы по месяцам
- **По годам** — данные сгруппированы по годам
- **Произвольный** — появляются поля "От" и "До" для выбора конкретного диапазона дат

**Карточки сводки:**
- Всего кВт·ч — общее потребление за выбранный период
- Стоимость — общая сумма
- T1 (день) — потребление дневного тарифа
- T2 (ночь) — потребление ночного тарифа

**Графики:**
- **"Потребление"** — столбчатая диаграмма T1/T2 по выбранным периодам
- **"Стоимость"** — линейный график с тремя линиями: T1, T2 и итого
- **"Средняя стоимость в день"** — помогает сравнить среднюю стоимость между периодами

### 6. Настройки

**Тема оформления:**
- **Светлая** — белый фон, тёмный текст
- **Тёмная** — тёмно-синий фон (по умолчанию)
- **Системная** — следует настройке вашей ОС

Тему также можно переключить кнопкой в правом верхнем углу на любой странице (иконка солнца/луны).

**Тарифы:**
- **T1 (день)** — стоимость 1 кВт·ч дневного тарифа (по умолчанию 3.94 руб.)
- **T2 (ночь)** — стоимость 1 кВт·ч ночного тарифа (по умолчанию 2.11 руб.)
- Нажмите **"Сохранить тарифы"** после изменения
- Ниже отображается **история тарифов** — все предыдущие значения с датами

**Важно:** изменение тарифа влияет только на новые записи. Ранее сохранённые показания хранят свой тариф на момент записи.

**Данные:**
- **Экспорт в JSON** — скачивает файл `electro-export-ГГГГ-ММ-ДД.json` со всеми показаниями и настройками. Используйте для резервного копирования или переноса на другое устройство.
- **Импорт из JSON** — загружает ранее экспортированный файл. Текущие данные заменяются импортированными.
- **Очистить все данные** — удаляет все показания. Действие необратимо. Перед очисткой рекомендуется сделать экспорт.

---

## Типичный сценарий использования

1. Каждый день (утром или вечером) открываете приложение
2. Переходите на **"Показания"**
3. Смотрите на счётчик и вводите текущие цифры T1 и T2
4. Видите мгновенный расчёт — сколько потребили и сколько это стоит
5. Нажимаете **"Сохранить"**
6. На **"Дашборде"** видите статистику за месяц
7. В **"Аналитике"** сравниваете потребление по месяцам/неделям
8. Раз в месяц делаете **экспорт** для резервной копии

---

## Перенос данных из Excel

Если у вас есть история показаний в Excel, вы можете перенести их через импорт JSON. Подготовьте файл в формате:

```json
{
  "version": 1,
  "readings": [
    {
      "id": "уникальный-id",
      "date": "2026-01-01",
      "t1Reading": 2511,
      "t2Reading": 2896,
      "t1Consumption": 0,
      "t2Consumption": 0,
      "t1Cost": 0,
      "t2Cost": 0,
      "totalCost": 0,
      "tariffSnapshot": { "t1Rate": 3.94, "t2Rate": 2.11 },
      "note": "",
      "createdAt": "2026-01-01T00:00:00.000Z"
    }
  ],
  "settings": {
    "currentTariff": { "t1Rate": 3.94, "t2Rate": 2.11 },
    "tariffHistory": []
  }
}
```

Для первой записи расход и стоимость = 0 (базовая точка). Для последующих записей расход рассчитается автоматически при импорте.

---

## Для разработчиков

### Стек технологий
- **React 19** — UI-фреймворк
- **Vite 7** — сборщик
- **Tailwind CSS 4** — стилизация
- **Zustand 5** — управление состоянием с persist middleware (localStorage)
- **Recharts 3** — графики
- **Framer Motion 12** — анимации
- **Lucide React** — иконки
- **date-fns 4** — работа с датами
- **React Router 7** — маршрутизация (BrowserRouter)

### Команды

```bash
npm install        # установка зависимостей
npm run dev        # запуск dev-сервера (http://localhost:5173/electro/)
npm run build      # production-сборка в папку dist/
npm run preview    # превью production-сборки
npm run deploy     # сборка + деплой на GitHub Pages
```

### Структура проекта

```
src/
├── components/
│   ├── ui/           # Button, Card, Input, Modal, Badge
│   ├── layout/       # AppLayout, Sidebar, BottomNav, TopBar
│   └── charts/       # ConsumptionChart, CostChart, TariffPieChart
├── pages/            # DashboardPage, ReadingsPage, HistoryPage,
│                     # AnalyticsPage, SettingsPage
├── store/            # Zustand stores (readings, settings)
├── utils/            # calculations, analytics, validation, export
├── hooks/            # useTheme
├── constants/        # тарифы, периоды, цвета графиков
├── App.jsx           # маршрутизация
├── main.jsx          # точка входа
└── index.css         # Tailwind + тема + CSS-переменные
```

### Хранение данных

Данные хранятся в `localStorage` под ключами:
- `electro-readings` — показания счётчика
- `electro-settings` — тарифы, тема, история тарифов

Формат: `{ state: { ... }, version: 1 }` (Zustand persist middleware).
